<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="R2049 åœ¨çº¿æ—¶é’Ÿ">
    <meta name="keywords" content="R2049, åœ¨çº¿æ—¶é’Ÿ, æ—¶é’Ÿ, æ—¶é—´, æ—¥æœŸ, å†œå†">
    <meta name="theme-color" content="#000000">
    <title>R2049 åœ¨çº¿æ—¶é’Ÿ</title>
    <link rel="icon" type="image/png" sizes="16x16" href="favicon-16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png">
    <link rel="icon" type="image/png" sizes="48x48" href="favicon-48.png">
    <link rel="icon" type="image/png" sizes="64x64" href="favicon-64.png">
    <link rel="icon" type="image/png" sizes="128x128" href="favicon-128.png">
    <link rel="icon" type="image/png" sizes="256x256" href="favicon-256.png">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="æ•°å­—æ—¶é’Ÿ">
    <style>
        /* å¼ºåˆ¶è®¾ç½®é»‘è‰²èƒŒæ™¯å’Œç™½è‰²æ–‡å­— */
        html, body {
            background-color: #000000 !important;
            color: #ffffff !important;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            -webkit-text-size-adjust: 100%; /* é˜²æ­¢iOSè®¾å¤‡ä¸Šçš„æ–‡æœ¬è‡ªåŠ¨è°ƒæ•´å¤§å° */
        }
        
        /* é’ˆå¯¹iPad 2çš„ç‰¹æ®Šä¿®å¤ */
        @media only screen and (device-width: 768px), 
               only screen and (device-width: 1024px),
               only screen and (min-device-width: 768px) and (max-device-width: 1024px) {
            html, body {
                background: #000000 !important;
                color: #ffffff !important;
            }
            .clock-container {
                padding-top: 30px !important;
                max-width: 90% !important;
                margin: 0 auto !important;
            }
            .time-unit {
                width: 140px !important;
                height: 140px !important;
                margin: 0 5px !important;
            }
            .digit {
                font-size: 90px !important;
                line-height: 1.1 !important;
            }
            .time-label {
                font-size: 16px !important;
            }
            .time-separator {
                font-size: 80px !important;
            }
        }
        
        /* åŸºæœ¬æ ·å¼ */
        .clock-container {
            text-align: center;
            padding: 20px;
        }
        
        .time-container {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 20px auto;
        }
        
        .time-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 120px;
            height: 120px;
            margin: 0 10px;
        }
        
        .digits-container {
            display: flex;
        }
        
        .digit {
            font-size: 80px;
            font-weight: bold;
        }
        
        .time-separator {
            font-size: 70px;
            font-weight: bold;
            margin: 0 5px;
        }
        
        .date-info, .lunar-date, .weather-info {
            margin: 10px 0;
            font-size: 18px;
        }
        
        /* ä¼˜åŒ–é“¾æ¥æ ·å¼ */
        a {
            color: #ffffff;
            text-decoration: none;
        }
        
        a:hover {
            text-decoration: underline;
        }
        
        /* ä¼˜åŒ–é€‰æ‹©å™¨æ ·å¼ */
        .city-selector select {
            background-color: #333;
            color: white;
            border: 1px solid #555;
            padding: 5px 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
    </style>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
</head>
<body>
    <div class="clock-container">
        <div class="header-container">
            <h1 class="clock-title">R2049 åœ¨çº¿æ—¶é’Ÿ</h1>

            <!-- æ·»åŠ åŸå¸‚é€‰æ‹©åŠŸèƒ½ -->
            <div class="city-selector">
                <select id="city-select">
                    <option value="ä¸Šæµ·" selected>ä¸Šæµ·</option>
                    <option value="åŒ—äº¬">åŒ—äº¬</option>
                    <option value="å¹¿å·">å¹¿å·</option>
                    <option value="æ·±åœ³">æ·±åœ³</option>
                    <option value="æ­å·">æ­å·</option>
                    <option value="æˆéƒ½">æˆéƒ½</option>
                    <option value="é‡åº†">é‡åº†</option>
                    <option value="æ­¦æ±‰">æ­¦æ±‰</option>
                    <option value="è¥¿å®‰">è¥¿å®‰</option>
                    <option value="å—äº¬">å—äº¬</option>
                    <option value="é•¿æ²™">é•¿æ²™</option>
                    <option value="å¦é—¨">å¦é—¨</option>
                    <option value="é’å²›">é’å²›</option>
                    <option value="å¤©æ´¥">å¤©æ´¥</option>
                    <option value="éƒ‘å·">éƒ‘å·</option>
                    <option value="ä¸œè">ä¸œè</option>
                    <option value="ä½›å±±">ä½›å±±</option>
                </select>
            </div>
        </div>

        <!-- æ·»åŠ å•è¯ä¿¡æ¯ -->
        <a href="https://w.r2049.cn/" target="_blank"><div class="word-info" id="word-info">å•è¯ä¿¡æ¯åŠ è½½ä¸­...</div></a>

        <!-- ä¿®æ”¹å¤©æ°”ä¿¡æ¯é“¾æ¥ -->
        <a href="https://wttr.r2049.cn/" target="_blank"><div class="weather-info" id="weather-info">å¤©æ°”ä¿¡æ¯åŠ è½½ä¸­...</div></a>
        
        <div class="date-info" id="date-info">åŠ è½½ä¸­...</div>
        <div class="lunar-date" id="lunar-date">å†œå†åŠ è½½ä¸­...</div>
        
        <div class="time-container">
            <div class="time-unit" id="hour-unit">
                <div class="time-label">æ—¶</div>
                <div class="digits-container">
                    <div class="digit">0</div>
                    <div class="digit">0</div>
                </div>
            </div>
            
            <div class="time-separator">:</div>
            
            <div class="time-unit" id="minute-unit">
                <div class="time-label">åˆ†</div>
                <div class="digits-container">
                    <div class="digit">0</div>
                    <div class="digit">0</div>
                </div>
            </div>
            
            <div class="time-separator">:</div>
            
            <div class="time-unit" id="second-unit">
                <div class="time-label">ç§’</div>
                <div class="digits-container">
                    <div class="digit">0</div>
                    <div class="digit">0</div>
                </div>
            </div>
        </div>
        
        <a href="https://www.jinrishici.com/" target="_blank" style="color: white; text-decoration: none;">
            <span id="jinrishici-sentence">æ­£åœ¨åŠ è½½ä»Šæ—¥è¯—è¯....</span>
        </a>
        <div class="pwa-install-hint" style="margin-top: 10px;text-align: center;">
          <a href="#" id="install-button" >ğŸ“± æ·»åŠ åˆ°ä¸»å±å¹•</a>
        </div>
        <div class="footer">Power By <a href="https://github.com/liguobao/web-clock" target="_blank">@liguobao/web-clock</a></div>
    </div>

    <!-- æ·»åŠ å†…è”è„šæœ¬ä»¥ç¡®ä¿åŸºæœ¬åŠŸèƒ½åœ¨æ—§è®¾å¤‡ä¸Šå·¥ä½œ -->
    <script>
        // åŸºæœ¬æ—¶é—´æ›´æ–°å‡½æ•° - å†…è”ä»¥ç¡®ä¿åœ¨æ—§è®¾å¤‡ä¸Šå¯é å·¥ä½œ
        function updateBasicTime() {
            try {
                var now = new Date();
                
                // æ›´æ–°æ—¥æœŸä¿¡æ¯
                var dateInfoEl = document.getElementById('date-info');
                if (dateInfoEl) {
                    var weekdays = ["æ˜ŸæœŸæ—¥", "æ˜ŸæœŸä¸€", "æ˜ŸæœŸäºŒ", "æ˜ŸæœŸä¸‰", "æ˜ŸæœŸå››", "æ˜ŸæœŸäº”", "æ˜ŸæœŸå…­"];
                    var month = now.getMonth() + 1;
                    var date = now.getDate();
                    // æ·»åŠ å‰å¯¼é›¶
                    month = month < 10 ? "0" + month : month;
                    date = date < 10 ? "0" + date : date;
                    dateInfoEl.textContent = now.getFullYear() + "å¹´" + month + "æœˆ" + date + "æ—¥ " + weekdays[now.getDay()];
                }
                
                // æ›´æ–°å†œå†æ—¥æœŸ - ä½¿ç”¨ç¼“å­˜å‡å°‘è®¡ç®—
                var lunarDateEl = document.getElementById('lunar-date');
                if (lunarDateEl) {
                    // æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°å†œå†ï¼ˆæ—¥æœŸå˜åŒ–ï¼‰
                    var currentDateStr = now.getFullYear() + "-" + (now.getMonth() + 1) + "-" + now.getDate();
                    if (!cachedLunarDate || lastLunarCalcDate !== currentDateStr) {
                        try {
                            cachedLunarDate = getLunarDate(now);
                            lastLunarCalcDate = currentDateStr;
                            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ä»¥å‡å°‘è®¡ç®—
                            try {
                                localStorage.setItem('cachedLunarDate', cachedLunarDate);
                                localStorage.setItem('lastLunarCalcDate', lastLunarCalcDate);
                            } catch(e) {
                                // å¿½ç•¥å­˜å‚¨é”™è¯¯
                            }
                        } catch(e) {
                            console.error("å†œå†è®¡ç®—é”™è¯¯", e);
                            cachedLunarDate = "å†œå†ä¿¡æ¯æš‚ä¸å¯ç”¨";
                        }
                    }
                    lunarDateEl.textContent = cachedLunarDate;
                }
                
                // æ›´æ–°æ—¶é—´
                updateTimeOnly();
            } catch (err) {
                console.error("æ›´æ–°æ—¶é—´å‡ºé”™", err);
            }
        }

        // æ›´æ–°å…ƒç´ å†…å®¹ - ä¼˜åŒ–ç‰ˆæœ¬
        function updateSimpleElement(id, value) {
            try {
                var el = document.getElementById(id);
                if (!el) return;
                
                var digits = el.getElementsByClassName('digit');
                if (digits.length >= 2) {
                    // åªæœ‰å½“æ•°å­—å˜åŒ–æ—¶æ‰æ›´æ–°DOMï¼Œå‡å°‘é‡ç»˜
                    if (digits[0].textContent !== value[0]) {
                        digits[0].textContent = value[0];
                    }
                    if (digits[1].textContent !== value[1]) {
                        digits[1].textContent = value[1];
                    }
                }
            } catch (err) {
                console.error("æ›´æ–°å…ƒç´ å‡ºé”™", err);
            }
        }
        
        // å†œå†æ—¥æœŸè®¡ç®—å‡½æ•° - ä½¿ç”¨åŸå§‹å®Œæ•´ç®—æ³•
        function getLunarDate(date) {
            try {
                var lunarInfo = [
                    0x04bd8, 0x04ae0, 0x0a570, 0x054d5, 0x0d260, 0x0d950, 0x16554, 0x056a0, 0x09ad0, 0x055d2,
                    0x04ae0, 0x0a5b6, 0x0a4d0, 0x0d250, 0x1d255, 0x0b540, 0x0d6a0, 0x0ada2, 0x095b0, 0x14977,
                    0x04970, 0x0a4b0, 0x0b4b5, 0x06a50, 0x06d40, 0x1ab54, 0x02b60, 0x09570, 0x052f2, 0x04970,
                    0x06566, 0x0d4a0, 0x0ea50, 0x06e95, 0x05ad0, 0x02b60, 0x186e3, 0x092e0, 0x1c8d7, 0x0c950,
                    0x0d4a0, 0x1d8a6, 0x0b550, 0x056a0, 0x1a5b4, 0x025d0, 0x092d0, 0x0d2b2, 0x0a950, 0x0b557,
                    0x06ca0, 0x0b550, 0x15355, 0x04da0, 0x0a5d0, 0x14573, 0x052d0, 0x0a9a8, 0x0e950, 0x06aa0,
                    0x0aea6, 0x0ab50, 0x04b60, 0x0aae4, 0x0a570, 0x05260, 0x0f263, 0x0d950, 0x05b57, 0x056a0,
                    0x096d0, 0x04dd5, 0x04ad0, 0x0a4d0, 0x0d4d4, 0x0d250, 0x0d558, 0x0b540, 0x0b5a0, 0x195a6,
                    0x095b0, 0x049b0, 0x0a974, 0x0a4b0, 0x0b27a, 0x06a50, 0x06d40, 0x0af46, 0x0ab60, 0x09570,
                    0x04af5, 0x04970, 0x064b0, 0x074a3, 0x0ea50, 0x06b58, 0x055c0, 0x0ab60, 0x096d5, 0x092e0,
                    0x0c960, 0x0d954, 0x0d4a0, 0x0da50, 0x07552, 0x056a0, 0x0abb7, 0x025d0, 0x092d0, 0x0cab5,
                    0x0a950, 0x0b4a0, 0x0baa4, 0x0ad50, 0x055d9, 0x04ba0, 0x0a5b0, 0x15176, 0x052b0, 0x0a930,
                    0x07954, 0x06aa0, 0x0ad50, 0x05b52, 0x04b60, 0x0a6e6, 0x0a4e0, 0x0d260, 0x0ea65, 0x0d530,
                    0x05aa0, 0x076a3, 0x096d0, 0x04bd7, 0x04ad0, 0x0a4d0, 0x1d0b6, 0x0d250, 0x0d520, 0x0dd45,
                    0x0b5a0, 0x056d0, 0x055b2, 0x049b0, 0x0a577, 0x0a4b0, 0x0aa50, 0x1b255, 0x06d20, 0x0ada0
                ];

                var Animals = ["é¼ ", "ç‰›", "è™", "å…”", "é¾™", "è›‡", "é©¬", "ç¾Š", "çŒ´", "é¸¡", "ç‹—", "çŒª"];
                var Gan = ["ç”²", "ä¹™", "ä¸™", "ä¸", "æˆŠ", "å·±", "åºš", "è¾›", "å£¬", "ç™¸"];
                var Zhi = ["å­", "ä¸‘", "å¯…", "å¯", "è¾°", "å·³", "åˆ", "æœª", "ç”³", "é…‰", "æˆŒ", "äº¥"];
                var nStr1 = ["æ­£", "äºŒ", "ä¸‰", "å››", "äº”", "å…­", "ä¸ƒ", "å…«", "ä¹", "å", "å†¬", "è…Š"];
                var nStr2 = ["åˆä¸€", "åˆäºŒ", "åˆä¸‰", "åˆå››", "åˆäº”", "åˆå…­", "åˆä¸ƒ", "åˆå…«", "åˆä¹", "åˆå",
                          "åä¸€", "åäºŒ", "åä¸‰", "åå››", "åäº”", "åå…­", "åä¸ƒ", "åå…«", "åä¹", "äºŒå",
                          "å»¿ä¸€", "å»¿äºŒ", "å»¿ä¸‰", "å»¿å››", "å»¿äº”", "å»¿å…­", "å»¿ä¸ƒ", "å»¿å…«", "å»¿ä¹", "ä¸‰å"];

                // å¦‚æœè¾“å…¥çš„æ—¥æœŸä¸ºç©ºï¼Œåˆ™ä½¿ç”¨å½“å‰æ—¥æœŸ
                if (!date) {
                    date = new Date();
                }

                // è®¡ç®—å†œå†å¹´ä»½
                var i, leap = 0, temp = 0;
                var baseDate = new Date(1900, 0, 31);
                var offset = Math.floor((date - baseDate) / 86400000);

                // è®¡ç®—å¹´ä»½
                var year = 1900;
                for (i = 0; i < 2050 - 1900 && offset > 0; i++) {
                    temp = getLunarYearDays(year + i);
                    offset -= temp;
                }
                if (offset < 0) {
                    offset += temp;
                    i--;
                }
                year += i;

                // è®¡ç®—é—°æœˆ
                leap = getLeapMonth(year);
                var isLeap = false;

                // è®¡ç®—æœˆä»½
                var month = 1;
                for (i = 1; i < 13 && offset > 0; i++) {
                    if (leap > 0 && i === (leap + 1) && isLeap === false) {
                        --i;
                        isLeap = true;
                        temp = getLeapDays(year);
                    } else {
                        temp = getMonthDays(year, i);
                    }
                    if (isLeap === true && i === (leap + 1)) isLeap = false;
                    offset -= temp;
                }
                if (offset < 0) {
                    offset += temp;
                    --i;
                }
                month = i;

                // è®¡ç®—æ—¥æœŸ
                var day = offset + 1;

                // å¤©å¹²åœ°æ”¯å¹´
                var ganYear = (year - 3) % 10;
                var zhiYear = (year - 3) % 12;
                if (ganYear === 0) ganYear = 10;
                if (zhiYear === 0) zhiYear = 12;

                // è¿”å›å†œå†æ—¥æœŸå­—ç¬¦ä¸² - ä½¿ç”¨åŸå§‹æ ¼å¼
                return "å†œå†" + Gan[ganYear-1] + Zhi[zhiYear-1] + "å¹´ " + nStr1[month-1] + "æœˆ" + nStr2[day-1];

                // è¾…åŠ©å‡½æ•°
                function getLunarYearDays(y) {
                    var i, sum = 348;
                    for (i = 0x8000; i > 0x8; i >>= 1) sum += (lunarInfo[y - 1900] & i) ? 1 : 0;
                    return sum + getLeapDays(y);
                }

                function getLeapDays(y) {
                    if (getLeapMonth(y)) return (lunarInfo[y - 1900] & 0x10000) ? 30 : 29;
                    return 0;
                }

                function getLeapMonth(y) {
                    return lunarInfo[y - 1900] & 0xf;
                }

                function getMonthDays(y, m) {
                    return (lunarInfo[y - 1900] & (0x10000 >> m)) ? 30 : 29;
                }
            } catch(e) {
                console.error("å†œå†è®¡ç®—é”™è¯¯", e);
                return "å†œå†ä¿¡æ¯æš‚ä¸å¯ç”¨";
            }
        }
        
        // ç¼“å­˜å†œå†è®¡ç®—ç»“æœ - é¿å…é¢‘ç¹è®¡ç®—
        var cachedLunarDate = "";
        var lastLunarCalcDate = "";
        
        // åªæ›´æ–°æ—¶é—´ï¼Œä¸æ›´æ–°å†œå†å’Œæ—¥æœŸ
        function updateTimeOnly() {
            try {
                var now = new Date();
                
                // æ›´æ–°æ—¶é—´
                var h = now.getHours();
                var m = now.getMinutes();
                var s = now.getSeconds();
                
                // æ·»åŠ å‰å¯¼é›¶
                h = h < 10 ? "0" + h : h.toString();
                m = m < 10 ? "0" + m : m.toString();
                s = s < 10 ? "0" + s : s.toString();
                
                // ç®€å•æ›´æ–°æ—¶é—´æ˜¾ç¤º
                updateSimpleElement('hour-unit', h);
                updateSimpleElement('minute-unit', m);
                updateSimpleElement('second-unit', s);
            } catch (err) {
                console.error("æ›´æ–°æ—¶é—´å‡ºé”™", err);
            }
        }
        
        // è·å–å¤©æ°”ä¿¡æ¯ - ä¼˜åŒ–ç‰ˆæœ¬
        function getWeatherInfo(city) {
            try {
                var weatherInfoEl = document.getElementById('weather-info');
                if (!weatherInfoEl) return;
                
                // æ£€æŸ¥ç¼“å­˜
                var cachedWeather = localStorage.getItem('weatherInfo_' + city);
                var cachedTime = localStorage.getItem('weatherTime_' + city);
                
                // å¦‚æœæœ‰ç¼“å­˜ä¸”ä¸è¶…è¿‡1å°æ—¶ï¼Œç›´æ¥ä½¿ç”¨ç¼“å­˜
                if (cachedWeather && cachedTime) {
                    var now = new Date().getTime();
                    if (now - parseInt(cachedTime) < 3600000) { // 1å°æ—¶å†…
                        weatherInfoEl.textContent = cachedWeather;
                        return;
                    }
                }
                
                // æ˜¾ç¤ºåŠ è½½ä¸­çŠ¶æ€
                weatherInfoEl.textContent = "æ­£åœ¨è·å–å¤©æ°”ä¿¡æ¯...";
                
                // æ„å»ºè¯·æ±‚URL
                var encodedCity = encodeURIComponent(city || 'ä¸Šæµ·');
                var url = 'https://wttr.r2049.cn/?location=' + encodedCity;
                
                // ä½¿ç”¨ç®€å•çš„XMLHttpRequest
                var xhr = new XMLHttpRequest();
                xhr.open('GET', url, true);
                xhr.timeout = 10000; // 10ç§’è¶…æ—¶
                
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4) {
                        if (xhr.status === 200) {
                            var response = xhr.responseText;
                            weatherInfoEl.textContent = response;
                            
                            // ç¼“å­˜ç»“æœ
                            try {
                                localStorage.setItem('weatherInfo_' + city, response);
                                localStorage.setItem('weatherTime_' + city, new Date().getTime());
                            } catch(e) {
                                // å¿½ç•¥å­˜å‚¨é”™è¯¯
                            }
                        } else {
                            weatherInfoEl.textContent = "å¤©æ°”ä¿¡æ¯è·å–å¤±è´¥";
                        }
                    }
                };
                
                xhr.ontimeout = function() {
                    weatherInfoEl.textContent = "å¤©æ°”ä¿¡æ¯è¯·æ±‚è¶…æ—¶";
                };
                
                xhr.onerror = function() {
                    weatherInfoEl.textContent = "å¤©æ°”ä¿¡æ¯è·å–å¤±è´¥";
                };
                
                xhr.send();
            } catch (err) {
                console.error("è·å–å¤©æ°”ä¿¡æ¯å‡ºé”™:", err);
                if (weatherInfoEl) {
                    weatherInfoEl.textContent = "å¤©æ°”ä¿¡æ¯æš‚ä¸å¯ç”¨";
                }
            }
        }
        
        // è·å–å•è¯ä¿¡æ¯
        function getWordInfo() {
            try {
                var wordInfoEl = document.getElementById('word-info');
                if (!wordInfoEl) return;
                
                // æ˜¾ç¤ºåŠ è½½ä¸­çŠ¶æ€
                wordInfoEl.textContent = "æ­£åœ¨è·å–å•è¯ä¿¡æ¯...";
                
                // æ„å»ºè¯·æ±‚URL
                var url = 'https://w.r2049.cn/get-word/';
                
                // è·å–å•è¯çš„å‡½æ•°
                function fetchWord() {
                    var xhr = new XMLHttpRequest();
                    xhr.open('GET', url, true);
                    xhr.timeout = 10000; // 10ç§’è¶…æ—¶
                    
                    xhr.onreadystatechange = function() {
                        if (xhr.readyState === 4) {
                            if (xhr.status === 200) {
                                wordInfoEl.textContent = xhr.responseText;
                            } else {
                                wordInfoEl.textContent = "å•è¯ä¿¡æ¯è·å–å¤±è´¥";
                            }
                        }
                    };
                    
                    xhr.ontimeout = function() {
                        wordInfoEl.textContent = "å•è¯ä¿¡æ¯è¯·æ±‚è¶…æ—¶";
                    };
                    
                    xhr.onerror = function() {
                        wordInfoEl.textContent = "å•è¯ä¿¡æ¯è·å–å¤±è´¥";
                    };
                    
                    xhr.send();
                }
                
                // é¦–æ¬¡è·å–å•è¯
                fetchWord();
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶ï¼Œæ¯æ¬¡ç‚¹å‡»è·å–æ–°å•è¯
                wordInfoEl.addEventListener('click', function(e) {
                    e.preventDefault(); // é˜»æ­¢é»˜è®¤é“¾æ¥è¡Œä¸º
                    wordInfoEl.textContent = "æ­£åœ¨è·å–æ–°å•è¯...";
                    fetchWord();
                    return false;
                });
                
                // ä¿®æ”¹çˆ¶å…ƒç´ çš„é“¾æ¥ç‚¹å‡»è¡Œä¸º
                var wordLinkEl = wordInfoEl.parentElement;
                if (wordLinkEl && wordLinkEl.tagName === 'A') {
                    wordLinkEl.addEventListener('click', function(e) {
                        e.preventDefault(); // é˜»æ­¢é»˜è®¤é“¾æ¥è¡Œä¸º
                        wordInfoEl.textContent = "æ­£åœ¨è·å–æ–°å•è¯...";
                        fetchWord();
                        return false;
                    });
                }
                
            } catch (err) {
                console.error("è·å–å•è¯ä¿¡æ¯å‡ºé”™:", err);
                if (wordInfoEl) {
                    wordInfoEl.textContent = "å•è¯ä¿¡æ¯æš‚ä¸å¯ç”¨";
                }
            }
        }
        
        // ä¸“é—¨å¤„ç†ä»Šæ—¥è¯—è¯çš„å‡½æ•°
        function loadJinrishici() {
            var sentenceElement = document.getElementById('jinrishici-sentence');
            if (!sentenceElement) return;
            
            // ç›´æ¥ä½¿ç”¨jinrishiciå…¨å±€å¯¹è±¡
            if (window.jinrishici) {
                window.jinrishici.load(function(result) {
                    sentenceElement.innerText = result.data.content;
                });
            } else {
                // å¦‚æœSDKæœªåŠ è½½ï¼Œæ‰‹åŠ¨åŠ è½½
                var script = document.createElement('script');
                script.src = 'https://sdk.jinrishici.com/v2/browser/jinrishici.js';
                script.charset = 'utf-8';
                script.onload = function() {
                    if (window.jinrishici) {
                        window.jinrishici.load(function(result) {
                            sentenceElement.innerText = result.data.content;
                        });
                    }
                };
                document.head.appendChild(script);
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        function initClock() {
            // å°è¯•ä»æœ¬åœ°å­˜å‚¨æ¢å¤å†œå†ç¼“å­˜
            try {
                cachedLunarDate = localStorage.getItem('cachedLunarDate') || "";
                lastLunarCalcDate = localStorage.getItem('lastLunarCalcDate') || "";
            } catch(e) {
                // å¿½ç•¥å­˜å‚¨é”™è¯¯
            }
            
            // ç«‹å³æ›´æ–°ä¸€æ¬¡å®Œæ•´ä¿¡æ¯
            updateBasicTime();
            
            // æ¯ç§’æ›´æ–°æ—¶é—´ï¼Œä½†ä¸æ›´æ–°å†œå†
            var timeInterval = setInterval(function() {
                updateTimeOnly();
            }, 1000);
            
            // æ¯10åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æ—¥æœŸå˜åŒ–
            var dateInterval = setInterval(function() {
                updateBasicTime();
            }, 600000); // 10åˆ†é’Ÿ
            
            // æ¯15åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡é¡µé¢
            setInterval(function() {
                window.location.reload();
            }, 900000); // 15åˆ†é’Ÿ
            
            // å°è¯•è·å–å¤©æ°”ä¿¡æ¯
            var citySelect = document.getElementById('city-select');
            var city = 'ä¸Šæµ·';
            
            // ä»æœ¬åœ°å­˜å‚¨åŠ è½½ä¸Šæ¬¡é€‰æ‹©çš„åŸå¸‚
            try {
                var savedCity = localStorage.getItem('selectedCity');
                if (savedCity && citySelect) {
                    citySelect.value = savedCity;
                    city = savedCity;
                }
            } catch(e) {
                // å¿½ç•¥å­˜å‚¨é”™è¯¯
            }
            
            getWeatherInfo(city);
            
            // è·å–å•è¯ä¿¡æ¯
            getWordInfo();
            
            // å¦‚æœæœ‰åŸå¸‚é€‰æ‹©å™¨ï¼Œæ·»åŠ äº‹ä»¶
            if (citySelect) {
                citySelect.onchange = function() {
                    var selectedCity = this.value;
                    try {
                        localStorage.setItem('selectedCity', selectedCity);
                    } catch(e) {
                        // å¿½ç•¥å­˜å‚¨é”™è¯¯
                    }
                    getWeatherInfo(selectedCity);
                };
            }
            
            // æ·»åŠ å¯è§æ€§å˜åŒ–ç›‘å¬ï¼Œä¼˜åŒ–ç”µæ± ä½¿ç”¨
            if (document.hidden !== undefined) {
                document.addEventListener('visibilitychange', function() {
                    if (document.hidden) {
                        // é¡µé¢ä¸å¯è§æ—¶ï¼Œå‡å°‘æ›´æ–°é¢‘ç‡
                        clearInterval(timeInterval);
                        timeInterval = setInterval(updateTimeOnly, 10000); // 10ç§’æ›´æ–°ä¸€æ¬¡
                    } else {
                        // é¡µé¢å¯è§æ—¶ï¼Œæ¢å¤æ­£å¸¸æ›´æ–°é¢‘ç‡
                        clearInterval(timeInterval);
                        timeInterval = setInterval(updateTimeOnly, 1000);
                        // ç«‹å³æ›´æ–°ä¸€æ¬¡
                        updateBasicTime();
                    }
                });
            }
            
            // æ·»åŠ å®‰è£…PWAçš„äº‹ä»¶å¤„ç†
            var installButton = document.getElementById('install-button');
            if (installButton) {
                installButton.style.display = 'none'; // é»˜è®¤éšè—
                
                var deferredPrompt;
                window.addEventListener('beforeinstallprompt', function(e) {
                    e.preventDefault();
                    deferredPrompt = e;
                    installButton.style.display = 'block'; // æ˜¾ç¤ºå®‰è£…æŒ‰é’®
                });
                
                installButton.addEventListener('click', function() {
                    if (!deferredPrompt) return;
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then(function() {
                        deferredPrompt = null;
                        installButton.style.display = 'none';
                    });
                });
            }
            
            // å°è¯•åŠ è½½ä»Šæ—¥è¯—è¯
            loadJinrishici();
            
            // å¦‚æœ3ç§’åä»æœªåŠ è½½ï¼Œå†æ¬¡å°è¯•
            setTimeout(loadJinrishici, 3000);
        }
        
        // ä½¿ç”¨ä¼ ç»Ÿæ–¹å¼æ·»åŠ é¡µé¢åŠ è½½äº‹ä»¶
        if (window.addEventListener) {
            window.addEventListener('load', initClock, false);
        } else if (window.attachEvent) {
            window.attachEvent('onload', initClock);
        } else {
            window.onload = initClock;
        }
    </script>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FGRZTB4F5N"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FGRZTB4F5N');
    </script>
</body>
</html>
