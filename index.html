<!DOCTYPE html>
<html lang="zh-CN" style="background-color: #000000;">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="R2049 在线时钟">
    <meta name="keywords" content="R2049, 在线时钟, 时钟, 时间, 日期, 农历">
    <meta name="theme-color" content="#000000">
    <title>R2049 在线时钟</title>
    <style>
        /* 确保iPad 2上的基本样式 */
        html, body {
            background-color: #000000;
            color: #ffffff;
        }
        
        body.day-mode {
            background-color: #f0f0f0;
            color: #333333;
        }
    </style>
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="数字时钟">
    <!-- 内联脚本，确保基本内容能立即显示（为iPad 2等旧设备优化） -->
    <script>
        // 首先确保背景颜色设置正确
        document.documentElement.style.backgroundColor = "#000000";
        document.body.style.backgroundColor = "#000000";
        
        function updateBasicTime() {
            try {
                var now = new Date();
                
                // 更新日期信息
                var dateInfoEl = document.getElementById('date-info');
                if (dateInfoEl) {
                    var weekdays = ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"];
                    dateInfoEl.textContent = now.getFullYear() + "年" + (now.getMonth() + 1) + "月" + now.getDate() + "日 " + weekdays[now.getDay()];
                }
                
                // 设置农历占位符
                var lunarDateEl = document.getElementById('lunar-date');
                if (lunarDateEl) {
                    lunarDateEl.textContent = "农历数据加载中...";
                }
                
                // 更新时间
                var h = now.getHours();
                var m = now.getMinutes();
                var s = now.getSeconds();
                
                // 添加前导零
                h = h < 10 ? "0" + h : h.toString();
                m = m < 10 ? "0" + m : m.toString();
                s = s < 10 ? "0" + s : s.toString();
                
                // 简单更新时间显示
                updateSimpleElement('hour-unit', h);
                updateSimpleElement('minute-unit', m);
                updateSimpleElement('second-unit', s);
                
                // 设置白天/夜晚模式
                var isDayTime = h >= 6 && h < 18;
                if (isDayTime) {
                    document.body.className = 'day-mode';
                    document.body.style.backgroundColor = "#f0f0f0";
                } else {
                    document.body.className = 'night-mode';
                    document.body.style.backgroundColor = "#000000";
                }
            } catch (err) {
                console.error("内联脚本更新时间出错", err);
            }
        }
        
        function updateSimpleElement(id, value) {
            try {
                var el = document.getElementById(id);
                if (!el) return;
                
                var digits = el.getElementsByClassName('digit');
                if (digits.length >= 2) {
                    digits[0].textContent = value[0];
                    digits[1].textContent = value[1];
                }
            } catch (err) {
                console.error("更新元素出错", err);
            }
        }
        
        // 当页面首次加载时执行
        document.addEventListener("DOMContentLoaded", updateBasicTime);
        
        // 立即尝试执行一次
        if (document.readyState === "interactive" || document.readyState === "complete") {
            updateBasicTime();
        }
    </script>
</head>
<body style="background-color: #000000; color: #ffffff;">
    <div class="clock-container">
        <h1 class="clock-title">R2049 在线时钟</h1>
        <div class="date-info" id="date-info">加载中...</div>
        <div class="lunar-date" id="lunar-date">农历加载中...</div>
        
        <div class="time-container">
            <div class="time-unit" id="hour-unit">
                <div class="time-label">时</div>
                <div class="digits-container">
                    <div class="digit">0</div>
                    <div class="digit">0</div>
                </div>
            </div>
            
            <div class="time-separator">:</div>
            
            <div class="time-unit" id="minute-unit">
                <div class="time-label">分</div>
                <div class="digits-container">
                    <div class="digit">0</div>
                    <div class="digit">0</div>
                </div>
            </div>
            
            <div class="time-separator">:</div>
            
            <div class="time-unit" id="second-unit">
                <div class="time-label">秒</div>
                <div class="digits-container">
                    <div class="digit">0</div>
                    <div class="digit">0</div>
                </div>
            </div>
        </div>
        
        <!-- <div class="custom-message">在这里显示您的自定义信息</div> -->
        <a href="https://www.jinrishici.com/" target="_blank" style="color: white; text-decoration: none;">
            <span id="jinrishici-sentence">正在加载今日诗词....</span>
        </a>
        <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
        <div class="pwa-install-hint" style="margin-top: 10px;text-align: center;">
          <a href="#" id="install-button">📱 添加到主屏幕</a>
        </div>
        <div class="footer">Power By <a href="https://github.com/liguobao/web-clock" target="_blank">@liguobao/web-clock</a></div>
    </div>
    
    <!-- 在主内容后加载外部脚本 -->
    <script src="script.js"></script>

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-FGRZTB4F5N"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-FGRZTB4F5N');
    </script>

    <script>
        // 注册 Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(reg) { console.log('Service Worker 已注册'); })
                    .catch(function(err) { console.log('Service Worker 注册失败:', err); });
            });
        }
    </script>
</body>
</html>
